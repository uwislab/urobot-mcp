<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机器人仿真控制系统</title>
    <script src="/static/js/picoc-js/dist/bundle.umd.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 保持与robot_control.html相同的样式 */
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f8fafc;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: rgba(255, 255, 255, 0.98);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            max-width: 1400px;
            width: 100%;
            transition: all 0.3s ease;
        }
        /* 其他样式保持不变... */
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1><i class="fas fa-robot"></i> 机器人仿真控制系统 (C代码执行版)</h1>
            <button onclick="window.location.href='/'" 
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                           color: white; padding: 12px 24px; border: none; border-radius: 12px;
                           cursor: pointer; font-weight: 600; transition: all 0.3s;">
                <i class="fas fa-home"></i> 返回首页
            </button>
        </div>
        
        <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px;">
            <!-- 机器人仿真区域 -->
            <div class="simulation-panel">
                <div id="robotSimulation">
                    <div class="boundary" id="boundary-top"></div>
                    <div class="boundary" id="boundary-bottom"></div>
                    <div class="boundary" id="boundary-left"></div>
                    <div class="boundary" id="boundary-right"></div>
                    <div id="robot" data-rotation="0">
                        <div id="robotDirection"></div>
                    </div>
                </div>
            </div>

            <!-- 控制面板和输出区域 -->
            <div class="control-panel">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="control-group">
                            <h3>前进控制</h3>
                            <div>速度: <input type="number" id="forwardSpeed" min="1" max="8" value="4"></div>
                            <div>距离: <input type="number" id="forwardDistance" min="1" max="200" value="50"></div>
                            <button onclick="executeCommand('forward')">前进</button>
                        </div>

                        <div class="control-group">
                            <h3>后退控制</h3>
                            <div>速度: <input type="number" id="backSpeed" min="1" max="8" value="4"></div>
                            <div>距离: <input type="number" id="backDistance" min="1" max="200" value="50"></div>
                            <button onclick="executeCommand('back')">后退</button>
                        </div>

                        <div class="control-group">
                            <h3>转向控制</h3>
                            <div>角度: <input type="number" id="turnDegree" min="1" max="360" value="90"></div>
                            <div>
                                <button onclick="executeCommand('left')">左转</button>
                                <button onclick="executeCommand('right')">右转</button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="control-group">
                            <h3>控制台输出</h3>
                            <pre id="log" style="background: #f5f5f5; padding: 10px; border-radius: 5px; height: 200px; overflow: auto;"></pre>
                        </div>

                        <div class="control-group">
                            <h3>C语言命令</h3>
                            <div id="console" style="background: #1e1e1e; color: #d4d4d4; padding: 10px; border-radius: 5px; height: 200px; overflow: auto;">
                                <div>// 机器人控制命令记录</div>
                                <div>void main() {</div>
                                <div id="commandLog"></div>
                                <div>}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 生成C代码模板
        function generateCCode(action, params) {
            let code = `#include <stdio.h>

void forward(int speed, int distance) {
    printf("机器人以速度 %d 前进 %d 距离\\n", speed, distance);
}

void back(int speed, int distance) {
    printf("机器人以速度 %d 后退 %d 距离\\n", speed, distance);
}

void turn_left(int degree) {
    printf("机器人左转 %d 度\\n", degree);
}

void turn_right(int degree) {
    printf("机器人右转 %d 度\\n", degree);
}

int main() {
    `;

            switch(action) {
                case 'forward':
                    code += `forward(${params.speed}, ${params.distance});`;
                    break;
                case 'back':
                    code += `back(${params.speed}, ${params.distance});`;
                    break;
                case 'left':
                    code += `turn_left(${params.degree});`;
                    break;
                case 'right':
                    code += `turn_right(${params.degree});`;
                    break;
            }

            code += `
    return 0;
}`;

            return code;
        }

        // 执行C代码命令
        function executeCommand(action) {
            const robot = document.getElementById('robot');
            let cCode = '';
            let command = '';

            // 获取参数并生成C代码
            switch(action) {
                case 'forward':
                    const forwardSpeed = parseInt(document.getElementById('forwardSpeed').value);
                    const forwardDistance = parseInt(document.getElementById('forwardDistance').value);
                    cCode = generateCCode('forward', {speed: forwardSpeed, distance: forwardDistance});
                    command = `    forward(${forwardSpeed}, ${forwardDistance});`;
                    moveRobotWithRotation(robot, forwardDistance, forwardSpeed);
                    break;

                case 'back':
                    const backSpeed = parseInt(document.getElementById('backSpeed').value);
                    const backDistance = parseInt(document.getElementById('backDistance').value);
                    cCode = generateCCode('back', {speed: backSpeed, distance: backDistance});
                    command = `    back(${backSpeed}, ${backDistance});`;
                    moveRobotWithRotation(robot, -backDistance, backSpeed);
                    break;

                case 'left':
                    const leftDegree = parseInt(document.getElementById('turnDegree').value);
                    cCode = generateCCode('left', {degree: leftDegree});
                    command = `    turn_left(${leftDegree});`;
                    const currentRot = parseInt(robot.dataset.rotation || '0');
                    const newRot = (currentRot - leftDegree) % 360;
                    robot.style.transform = `rotate(${newRot}deg)`;
                    robot.dataset.rotation = newRot;
                    break;

                case 'right':
                    const rightDegree = parseInt(document.getElementById('turnDegree').value);
                    cCode = generateCCode('right', {degree: rightDegree});
                    command = `    turn_right(${rightDegree});`;
                    const rightCurrentRot = parseInt(robot.dataset.rotation || '0');
                    const rightNewRot = (rightCurrentRot + rightDegree) % 360;
                    robot.style.transform = `rotate(${rightNewRot}deg)`;
                    robot.dataset.rotation = rightNewRot;
                    break;
            }

            // 执行C代码
            picocjs.runC(cCode, (output) => {
                const logElement = document.getElementById('log');
                logElement.textContent += output + '\n';
                logElement.scrollTop = logElement.scrollHeight;
            });

            // 记录C语言命令
            if (command) {
                const commandLog = document.getElementById('commandLog');
                const commandElement = document.createElement('div');
                commandElement.className = 'command';
                commandElement.textContent = command;
                commandLog.appendChild(commandElement);
                commandLog.scrollTop = commandLog.scrollHeight;
            }
        }

        // 保持与robot_control.html相同的机器人移动和边界检测函数
        function moveRobotWithRotation(robot, distance, speed) {
            // 实现与robot_control.html相同的移动逻辑...
        }

        function checkBoundaryCollision(robot) {
            // 实现与robot_control.html相同的边界检测逻辑...
        }

        function handleBoundaryBounce(robot, hit) {
            // 实现与robot_control.html相同的边界反弹逻辑...
        }
    </script>
</body>
</html>
